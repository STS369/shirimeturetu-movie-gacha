# 今日の支離滅裂 Movie Gacha 🎬

入力した「愚痴・意味のない一言・支離滅裂な文章」を  
**ルールベース（if文）で雑に分類**し、  
The Movie Database (TMDB) API を使って映画を1本ガチャ表示する iOS アプリです。

> 正確な診断はしません。  
> 雰囲気だけ当てにいきます。

---

## 📱 アプリの流れ

1. 「今日の支離滅裂」を入力
2. 入力文を **キーワードベースで分類**
3. TMDB `discover` / `popular` API から候補取得
4. 候補の中から **ランダムで1本表示**
5. 映画は履歴に保存
6. 履歴から **コスト制限付きでデッキ構築**（評価値をコストとして使用）

---

## 🧠 使っている技術・学習ポイント

- **SwiftUI**
  - `@State` / `@EnvironmentObject` を使った状態管理
  - `NavigationStack` / `sheet` / `fullScreenCover` による画面遷移
- **非同期処理**
  - `async / await` + `URLSession`
- **設計**
  - View / ViewModel / Logic / Store の責務分離
- **アルゴリズム要素**
  - キーワードマッチによる分類（ルールベース）
  - ランダム選択（ガチャ）
  - 制約付き選択（デッキの合計コスト ≤ 28）
- **ローカル永続化**
  - `UserDefaults` による履歴・お気に入り・デッキ保存

---

## 🗂 フォルダ構成

```text
src/
├─ App/
├─ Views/
├─ ViewModels/
├─ Stores/
├─ Logic/
├─ Network/
├─ Models/
└─ Config/

```

---

## 🛠 工夫した点・学習内容との対応

本アプリは、これまでに授業や演習で学んだ内容を意識しながら設計・実装を行った。

### 1. 状態管理の使い分け（@State / @EnvironmentObject）

- 入力中のテキストや画面遷移フラグなど  
  → **画面ローカルで一時的な状態**は `@State` で管理
- お気に入り、履歴、デッキなど  
  → **複数画面で共有される状態**は `@EnvironmentObject` として管理

これにより、
- 画面ごとの責務が明確になる
- 状態の持ち方が混在しない
という点を意識した。

---


---

### 2. 非同期処理（async / await）の活用

TMDB API への通信はすべて `async / await` を用いて実装した。

- 通信中は `isLoading` を使って UI を制御
- 例外時は `do-catch` によりフォールバック処理を実装

非同期処理を View から直接書かず、  
**ViewModel に閉じ込める**ことを意識した。

---

### 3. アルゴリズム的要素の導入

本アプリには、以下のようなアルゴリズム的要素が含まれている。

- **キーワードマッチング**  
  入力文に特定の語が含まれているかを判定し、ジャンルIDを決定
- **ランダム選択（ガチャ）**  
  候補映画の配列から `randomElement()` により1本選択
- **制約付き選択（デッキ構築）**  
  映画の評価値（vote_average）をコストとして扱い、
  合計が上限（28）を超えないように映画を選択

単なる表示アプリではなく、
「条件に基づいて選ぶ」という処理を意識して実装した。

---

### 4. ローカル永続化の利用

- お気に入り
- ガチャ履歴
- デッキ状態

これらはすべて **UserDefaults** に保存し、  
アプリを再起動しても状態が保持されるようにした。


---

## 📊 発表資料（pptx）

- 👉 **[発表資料（共有リンク）](https://docs.google.com/presentation/d/1IjrkM6HV0GC4pJA59GBDZ82y7sHRUDHT/edit?usp=drive_link&ouid=105330700326123250967&rtpof=true&sd=true)**

※ ブラウザでそのまま閲覧できます。


